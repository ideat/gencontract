<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace = "mindware.com.netbank.mappers.ClientLoanNetbankMapper">

    <resultMap type="clientloannetbank" id="ClientLoanNetbankResult">
        <id 	property="prmprcage" column="prmprcage"/>
        <result property="prmpragen" column="prmpragen"/>
        <result property="gbagendid" column="gbagendid"/>
        <result property="gbagenomb" column="gbagenomb"/>
        <result property="gbageeciv" column="gbageeciv"/>
        <result property="gbagesexo" column="gbagesexo"/>
        <result property="gbagedir" column="gbagedir"/>
        <result property="prmprnpre"  column="prmprnpre"/>
        <result property="prmprcmon" column="prmprcmon"/>
        <result property="prmprmdes" column="prmprmdes"/>
        <result property="prmprplzo" column="prmprplzo"/>
        <result property="prmprppgk" column="prmprppgk"/>
        <result property="prtsatbas" column="prtsatbas"/>
        <result property="prmprdiap" column="prmprdiap"/>
        <result property="prmprfreg" column="prmprfreg"/>
        <result property="prtsasprd" column="prtsasprd"/>
    </resultMap>


    <select id="findClientLoanNetbankByCreCod" resultMap="ClientLoanNetbankResult" parameterType="int">
        select prmprcage, prmpragen, prmprfreg, gbagendid,gbagenomb, gbageeciv, gbagesexo,
        case
        	when gbagedir1 is null then ''
        	else gbagedir1
        end || ' ' ||
        case
          when  gbagedir2 is null then ''
          else gbagedir2
        end as gbagedir,
        prmprnpre, prmprcmon, prmprmdes,
        case
          when prmpruplz = 1 then prmprplzo*12
          when prmpruplz = 2 then prmprplzo
          when prmpruplz = 3 then prmprplzo / 30
          else prmprplzo
         end as prmprplzo,

        prmprppgk, prmprdiap
        , case
            when prmprtsex is null then prtsatbas
            else prtsasprd
          end as prtsatbas
        , case
            when prtsasprd is null then 0
            else prtsasprd
          end as prtsasprd
        from gbage
        inner join prmpr on (prmprcage = gbagecage)
        left join prtsa on (prmprnpre = prtsanpre)
        where prmprnpre = #{prmprnpre}
        and  prtsafvig = (select MAX(prtsafvig) from prtsa where prtsanpre = #{prmprnpre})



    </select>


</mapper>